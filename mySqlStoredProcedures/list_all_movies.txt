CREATE DEFINER=`root`@`localhost` PROCEDURE `list_all_movies`(
identifierString TEXT)
BEGIN
START TRANSACTION;

		CREATE TABLE tempMatchedStatus AS
		SELECT status, movies.movie_id, movies.title, movies.director, 
					   GROUP_CONCAT(genre_name) AS 'genres'
		FROM movies
		JOIN (
			SELECT media_id, status
			FROM media_pieces
			WHERE media_type_id = 3) AS matchStatus
			ON matchStatus.media_id = movies.movie_id

		#Join with table that has the genres of the previously specified movie
		JOIN (
			SELECT genre_types.genre_name, media_genre.media_id, media_genre.media_type_id 
			FROM genre_types, media_genre
			WHERE media_genre.genre_id = genre_types.genre_id) AS genre_table
		ON matchStatus.media_id = genre_table.media_id AND genre_table.media_type_id = 3
		GROUP BY movies.title;
        
	IF identifierString = "Possessed Movie" THEN
		SELECT * 
        FROM tempMatchedStatus
        WHERE status = "Possessed Media";
	END IF;
	DROP TABLE tempMatchedStatus;
    
COMMIT;
END